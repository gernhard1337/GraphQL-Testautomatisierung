\section{Graphabdeckung}
\label{graphueberdeckung}

Die Graphabdeckung führt verschiedene Kriterien ein, die es ermöglichen, aus Graphen Pfade für Tests zu generieren.
GraphQL kann, wie im Kapitel~\ref{graphtheorieQL} gesehen, durch einen Graphen repräsentiert werden.
Hinter jedem Knoten des Graphen steckt ein Resolver, der potenziell einem eigenen Modul angehört.
Anfragen an GraphQL können Resolver beliebig miteinander kombinieren.
Um die möglichen Kombinationen zu testen, sollen Graphabdeckungskriterien genutzt werden.
Da in GraphQL zyklische Graphen erlaubt sind, ist der Testraum potentiell unendlich groß.
Dieses Problem kann durch die Verwendung von Graphabdeckung gelöst werden.
Zuerst wird aber weitere Theorie eingeführt.
Um Graphcoverage zu nutzen, wird die allgemeine Definition~\ref{gerichtetergraphdef} von gerichteten Graphen erweitert.
Im Testkontext definiert sich ein gerichteter Graph wie in Definition~\ref{defg} angegeben.

\begin{definition}
    Ein gerichteter Graph G ist definiert als
    \begin{description}
        \item[Menge N] von Knoten
        \item[Menge N_{0}] von Anfangsknoten, wobei N_{0} $\subseteq$ N
        \item[Menge N_{f}] von Endknoten, wobei N_{f} $\subseteq$ N
        \item[Menge E] von Kanten, wobei E $\subseteq$ N $\times$ N. Dabei ist die Menge als init(x) $\times$ target(y) definiert.
    \end{description}
    \caption{\cite[2.1 Overview]{software-testing}}
    \label{defg}
\end{definition}

Das $target$ aus Definition~\ref{defg} ist gleichzusetzen mit $ter$ aus Definition~\ref{gerichtetergraphdef}.
Mithilfe dieser Definition können zum Beispiel Kontrollflussgraphen abgebildet werden, indem die Einstiegspunkte die Anfangsknoten sind und die Endknoten die Austrittspunkte~\cite[vgl. S. 46]{software-testing}.
Ein Pfad innerhalb von eben definierten Graphen der in einem Knoten $x \in N_{0}$ startet und in einem Knoten $y \in N_{f}$ endet, nennt sich Testpfad~\cite[vgl. Def 2.31]{software-testing}.
Ziel ist es mithilfe von Abdeckungskriterien Testpfade zu ermitteln die einen Graphen ausreichend abdecken.
Ein Graph gilt als ausreichend abgedeckt wenn die Definition~\ref{graphcov} gilt.

\begin{definition}
    Gegeben sei eine Menge $TR$ von Testanforderungen für ein Graphabdeckungskriterium $C$.
    Eine Menge Tests $T$ erfüllt $C$ auf Graphen $G$ wenn gilt: Jedes Element von $TR$ ist durch mindestens einen Pfad p abgedeckt.
    Ein Pfad p deckt ein Element von $TR$ ab, wenn das Element von $TR$ ein Teilpfad von p ist.
    Dabei kann auch gelten, dass das Element von $TR$ = p ist.
    \cite[vgl. Def. 2.32]{software-testing}
    \label{graphcov}
\end{definition}

Hierfür werden in~\cite{software-testing} verschiedene Kriterien eingeführt.
Diese sollen im Folgenden definiert und erklärt werden.

\subsection{Graphabdeckungskriterien}

Ein Graphabdeckungskriterium ist eine Sammlung von Testanforderungen gemäß Definition~\ref{tr}, wobei die Anforderungen an Graphen gestellt werden.
Im Folgenden werden einige Graphabdeckungskriterien vorgestellt, so wie sie in~\cite{software-testing} definiert werden.

\subsubsection{Knotenabdeckung}

Wird erwartet, dass beim Testen jede definierte Methode zumindest einmal ausgeführt wird, so handelt es sich hierbei um Knotenabdeckung.
Dieses Kriterium ist weithin geläufig als $Blockabdeckung$ \cite[vgl. 2.2.1]{software-testing}.
Eine Menge $T$ an Tests erfüllt die Knotenabdeckung, wenn gilt, dass jeder erreichbare Knoten durch zumindest einen Test $t \in T$ besucht wird.
Formal definiert wird dies in Definition~\ref{nodecov}:

\begin{definition}
    \textbf{Knotenabdeckung}: $TR$ enthält jeden erreichbaren Knoten in $G$~\cite[vgl. Criterion 2.1]{software-testing}.
    \label{nodecov}
\end{definition}


\subsubsection{Kantenabdeckung}
\label{kantenabdeck}
Eine Granularitätsebene höher ist die Kantenabdeckung.
In diesem Kriterium wird gefordert, dass jede erreichbare Kante mindestens einmal in einer gegebenen Menge an Tests besucht wird.
Dabei wird die Pfadlänge aus Kapitel~\ref{pfad} benötigt.

\begin{definition}
    \textbf{Kantenabdeckung}: $TR$ enthält jeden erreichbaren Pfad der Länge bis zu 1 (Kanten), in $G$~\cite[vgl. Criterion 2.2]{software-testing}.
    \label{edgecov}
\end{definition}

Dadurch ist eingeschlossen, dass auch jeder Knoten besucht wird.
Es folgt daher, dass die Kantenabdeckung ein stärkeres Kriterium ist, da dieses die Knotenabdeckung automatisch beinhaltet.
Diese Gegebenheit wird sich weiterhin fortführen, sodass die Kriterien im Generellen stärker, aber auch schwerer zu berechnen werden.

\subsubsection{Kanten-Paar Abdeckung}

Die Kantenabdeckung betrachtet nur die einzelnen Pfade des Graphens.
Im Testkontext ist aber durchaus die zuvor ausgeführte Operation auch wichtig und muss im Testprozess berücksichtigt werden.
Um dem Rechnung zu tragen, wird die Kanten-Paar Abdeckung eingeführt.
Diese setzt voraus, dass eine Menge an Tests $T$ alle möglichen Kantenpaare durch mindestens einen Test abgedeckt hat.

\begin{definition}
    \textbf{Kanten-Paar Abdeckung}: $TR$ enthält jeden erreichbaren Pfad der Länge bis zu 2 (Kanten), in $G$~\cite[vgl. Criterion 2.3]{software-testing}.
    \label{edgepaircov}
\end{definition}

\subsubsection{PrimePfad Abdeckung}

Während die zuvor definierten Kriterien darauf achten, dass Knoten und Kanten(-paare) abgedeckt werden, muss auch in Beachtung
bezogen werden, dass im Testkontext durchaus alle Pfadkombinationen die existieren relevante Testfälle darstellen können.
Die Anzahl an allen azyklischen Pfadkombinationen wird jedoch selbst bei kleinen Programmen schnell groß\cite[vgl. S. 35]{software-testing}.
Gleichzeitig sind viele Pfadkombinationen Teile von längeren Pfaden und somit uninteressant im Testkontext~\cite[vgl. S. 35]{software-testing}.
Um dieses Problem zu lösen, wird die PrimePfad Abdeckung in Definition~\ref{primecov} eingeführt.

\begin{definition}
    \textbf{PrimePfad Abdeckung}: $TR$ enthält alle PrimePfade in $G$~\cite[vgl. Criterion 2.4]{software-testing}.
    \label{primecov}
\end{definition}

Ein PrimePfad ist definiert in Definition~\ref{primepfad}.

\begin{definition}
    Ein Pfad von $n_{l}$ zu $n_{i}$ ist ein PrimePfad, wenn gilt, dass dieser keinen Knoten doppelt enthält (mit Ausnahme von Start- und Endknoten) und
    der Pfad nicht Teilpfad eines anderen Pfades ist.
    \label{primepfad}
\end{definition}

Es sollen also die längsten, einfachen Pfade im Graphen abgedeckt werden.
Ein einfacher Pfad ist ein Pfad, der keinen Knoten doppelt enthält.
Ausnahme ist hierbei, dass Start und Endknoten gleich sein dürfen.
So wird eine umfassendere Abdeckung als in den vorherigen Abdeckungskriterien gewährleistet, da auch längere Pfadkombinationen dabei berücksichtigt werden.

\subsubsection{Vollständige Pfadabdeckung}

Idealerweise sollten Tests die gesamte Software abdecken.
Wie jedoch in Kapitel~\ref{abdeck} schon gezeigt ist dies oft nicht möglich.
Insbesondere wenn der Graph zyklisch ist, ist der Pfadraum unendlich und kann somit nicht vollständig abgedeckt werden~\cite[vgl. S. 36 ]{software-testing}.
Der Vollständigkeit halber soll dieses Kriterium hier dennoch definiert werden.

\begin{definition}
    \textbf{Vollständige Pfadabdeckung}: $TR$ enthält alle Pfade in $G$~\cite[vgl. Criterion 2.7]{software-testing}.
    \label{completecov}
\end{definition}

Sollte der zu testende Graph azyklisch sein, kann dieses Kriterium jedoch durchaus genutzt werden.

\subsection{Vergleich der Kriterien}
\label{vglkrits}
Die verschiedenen Abdeckungskriterien variieren in ihrer Granularität.
Ein kurzer Überblick soll hier gegeben werden.

\newcolumntype{C}{>{\centering\arraybackslash}X}
\begin{center}
    \begin{table}[!ht]
        \begin{tabularx}{\textwidth}{|C|C|}
            \hline
            \textbf{Kriterium} & \textbf{Granularität}  \\
            \hline
            \textbf{Knoten} & jeder Knoten in mindestens einem Testpfad  \\
            \hline
            \textbf{Kanten} & jede Kante in mindestens einem Testpfad \\
            \hline
            \textbf{Kanten-Paar} & jedes Kantenpaar in mindestens einem Testpfad  \\
            \hline
            \textbf{PrimePfad} & jeder PrimePfad in einem Testpfad  \\
            \hline
            \textbf{vollständige Pfade} & Alle möglichen Pfade \\
            \hline
        \end{tabularx}
        \caption{Vergleich der Graphabdeckungskriterien}
    \end{table}
\end{center}
\\

Die vorgestellten Abdeckungskriterien können hierarchisch sortiert werden.
Mit Erfüllung eines höher sortierten Kriteriums sind automatisch die tieferen Kriterien auch erfüllt~\cite[vgl. Figure 2.15]{software-testing}.
Die Hierarchisierung der Abdeckungskriterien ist durch Abbildung~\ref{abdeckhier} dargestellt.

\begin{figure}[H]
    \centering
    \includegraphics[width=0.4\textwidth,keepaspectratio]{img/subsum}
    \caption{Subsumtion der Abdeckungskriterien}
    \label{abdeckhier}
\end{figure}

Hierdurch gilt, dass zum Beispiel mit Kantenabdeckung automatisch auch Knotenabdeckung gewährleistet ist.
Es ist nicht gewährleistet, dass PrimePfad-Abdeckung auch KantenPaar-Abdeckung umsetzt.
Im Kontext des Integrationstestens sei jedoch gefolgert, dass die PrimePfad-Abdeckung ein stärkeres Abdeckungskriterium ist.
Dies folgt, weil die PrimePfad-Abdeckung längere Testpfade erzeugt was nach~\cite[vgl. RQ 1]{property-based-testing} für eine höhere Abdeckung sorgt.
Es sei außerdem angemerkt, dass die PrimePfad-Abdeckung fast, aber nicht vollständig die KantenPaar-Abdeckung umsetzt~\cite[vgl. S. 20]{introductiontosoftwaretestingpptx}.
Ein Auftreten von Eigenkanten, also Kanten von einem Knoten zu sich selbst, zeigt einen Unterschied zwischen PrimePfad und Kantenpaar-Abdeckung~\cite[vgl. S. 21]{introductiontosoftwaretestingpptx}.
Da im Sinne des Integrationstests jedoch davon ausgegangen wird, dass die einzelnen Module getestet sind, ist diese Eigenkante kein relevanter Integrationstest da
das Modul nur mit sich selbst arbeitet und somit keine Kombination von Modulen durch solch eine Kante getestet wird.